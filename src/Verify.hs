{-|
    Module      : Verify
    Description : Check if a solution is correct
    Copyright   : (C) Alexander Mattes, 2015
    License     : MIT
    Maintainer  : Alexander Mattes <alexm128@googlemail.com>
    Stability   : experimental
    Portability : portable

    Uses hash values to verify offline if a solution is correct.
-}
module Verify
    ( isCorrectFor
    , isCorrectlySolved
    , hash
    ) where


import Solve (ProblemID, Solution, solveProblem)

import Data.Bits (xor)
import Data.List (foldl')

-- | Type for hashes.
type Hash = Int

-- | Checks a solution via stored hash of the correct solution.
--   Returns 'Nothing' if no hash is stored.
isCorrectFor :: Solution -> ProblemID -> Maybe Bool
isCorrectFor s n = fmap (== hash s) $ lookup n hashedSolutions

-- | Checks if a problem is correctly solved via stored hash of the correct solution.
--   Returns 'Nothing' if no hash is stored.
isCorrectlySolved :: ProblemID -> Maybe Bool
isCorrectlySolved n = case solveProblem n of
                Nothing -> Just False
                Just s  -> isCorrectFor s n

-- | Simple hash function for strings. Variant of 'DJB2'.
hash :: Solution -> Hash
hash = foldl' (\h c -> 33*h `xor` toNumber c) 5381 where
    toNumber :: Char -> Int
    toNumber = (*7754304927747644779) . fromEnum -- random big number to spread hash values

-- | List of hashes for most Solutions.
hashedSolutions :: [(ProblemID,Hash)]
hashedSolutions =
    [ (  1, -8927243686157907966)
    , (  2, -4229232194357886997)
    , (  3, 5947506052168285829)
    , (  4, -7668041280048361179)
    , (  5, -8857247242512721895)
    , (  6, -572269080834634595)
    , (  7, 177902918997823010)
    , (  8, -5966916243685331926)
    , (  9, -6269798889445858611)
    , ( 10, 5568140233387009640)
    , ( 11, -2888178371438669271)
    , ( 12, 8298577557039000325)
    , ( 13, -250119213751507472)
    , ( 14, 4568925071582907772)
    , ( 15, 4079426887059678339)
    , ( 16, 7153568770567589199)
    , ( 17, -3795353043263003335)
    , ( 18, 778079656667805615)
    , ( 19, 1336790660036832440)
    , ( 20, 1459501353504270435)
    , ( 21, -6804302753906211639)
    , ( 22, 5170309900443995875)
    , ( 23, -5464028940760120510)
    , ( 24, -5089599389496323946)
    , ( 25, 1488242489275327306)
    , ( 26, 2989030996965994319)
    , ( 27, -6237326955991351982)
    , ( 28, 3621275536216573296)
    , ( 29, 7841311188492423796)
    , ( 30, 1839216114165015358)
    , ( 31, -8694325837155140811)
    , ( 32, 7273914694647931382)
    , ( 33, 2218390185098199646)
    , ( 34, 395071638087587093)
    , ( 35, 8149541029467842021)
    , ( 36, -174798468258680872)
    , ( 37, 9023758542303595835)
    , ( 38, 1950138387554725254)
    , ( 39, 2663498400409584609)
    , ( 40, 1652133230000679368)
    , ( 41, 7570378525260595389)
    , ( 42, 6900421371237710698)
    , ( 43, 8233236404188390557)
    , ( 44, -8107258465294398176)
    , ( 45, -3428149804694158092)
    , ( 46, -9022965529851926817)
    , ( 47, -1853446652922977266)
    , ( 48, -120965023496257027)
    , ( 49, 266212580752277233)
    , ( 50, 5726919319777582806)
    , ( 51, -9052473613755075464)
    , ( 52, -7016471445949818666)
    , ( 53, -5597491882505990381)
    , ( 54, -8073945610423558597)
    , ( 55, 5794790262980591916)
    , ( 56, 7567834790482464205)
    , ( 57, -6080439077322308984)
    , ( 58, -4430426355114870288)
    , ( 59, 6884399506803084950)
    , ( 60, 1675681192557637473)
    , ( 61, -7591641710787332755)
    , ( 62, -7739345820777764640)
    , ( 63, -6714009377420164118)
    , ( 64, 7691235760277520271)
    , ( 65, 5852202042877759736)
    , ( 66, -2011672119082677154)
    , ( 67, -8919428554658859854)
    , ( 68, -1275952117611484838)
    , ( 69, 3755894076079271557)
    , ( 70, -8898406206584829845)
    , ( 71, -5591351351322001635)
    , ( 72, 9171278772037668186)
    , ( 73, -4830702011321927808)
    , ( 74, -4399383923654127953)
    , ( 75, 1581741684739214250)
    , ( 76, 9147405838985878389)
    , ( 77, 7915597207205695011)
    , ( 78, 2020623975740728437)
    , ( 79, 6392829073241506541)
    , ( 80, 5011596293982455259)
    , ( 81, 8183364997793303135)
    , ( 82, 319921427643150634)
    , ( 83, -9148929141851128660)
    , ( 84, 6906280334554135528)
    , ( 85, -5429059053896105307)
    , ( 86, -8189945297909901819)
    , ( 87, -4638003549871822340)
    , ( 88, -4352677330691670164)
    , ( 89, 9209078829744500533)
    , ( 90, 5909940751223500190)
    , ( 91, 735080103784766281)
    , ( 92, 3619226495012503596)
    , ( 93, 5408631676173252951)
    , ( 94, 5224600009969064330)
    , ( 95, 1246648853061035898)
    , ( 96, -7530735121558102924)
    , ( 97, 5603712515827464115)
    , ( 98, -6101899217434255478)
    , ( 99, -1939690661850851173)
    , (100, -2798850116216873340)
    , (101, -6673662209430778503)
    , (102, -6643832658943599987)
    , (103, 3027980981679944879)
    , (104, -7892836847768963865)
    , (105, 1888603783349744162)
    , (106, -8351173376467207075)
    , (107, 5243055420766941419)
    , (108, -232460262313157275)
    , (109, -2508475538431646871)
    , (110, -8573218930969570131)
    , (111, -777692224517879022)
    , (112, -1247699965781959492)
    , (113, -3406471142084616237)
    , (114, 987099957430024523)
    , (115, -3374235087005422876)
    , (116, 2672842792801358518)
    , (117, 8460942271430663710)
    , (118, 7785358093536526799)
    , (119, 6992724890862953914)
    , (120, -2377886395869455315)
    , (121, 1772423958000991364)
    , (122, -8428866487274464969)
    , (123, 6898565888211650206)
    , (124, -235285174439107454)
    , (125, -6591491555899284011)
    , (126, -2459740461503066415)
    , (127, 4200505791628750648)
    , (128, -3085036259458610258)
    , (129, -2196243698992482263)
    , (130, 8056315911958851937)
    , (131, -308700514094984814)
    , (132, -3156622889112058393)
    , (133, -1613261261555467210)
    , (134, 388522482079654411)
    , (135, -7837732837649352111)
    , (136, 3847930664674817399)
    , (137, 8740213627650370309)
    , (138, -1956058564623811656)
    , (139, 6947264980463276720)
    , (140, -6284145776028046558)
    , (141, 2585005921941954797)
    , (142, -695010520427840171)
    , (143, -5079508099081174615)
    , (144, -739496445787746289)
    , (145, 794029398973434532)
    , (146, 8130651821880170370)
    , (147, 5836007387146129161)
    , (148, 100416208074141148)
    , (149, 8921238061724006188)
    , (150, -7728758213870139598)
    , (151, 1231308396761754892)
    , (152, -7253614209290856033)
    , (153, -4123155852592456889)
    , (154, -7239334608137040069)
    , (155, 7360754177409437275)
    , (156, -7271199858575075571)
    , (157, 5649789618225654636)
    , (158, 8427361592822788010)
    , (159, -6695428172537155350)
    , (160, 2552447251982634020)
    , (161, 4267676711318221440)
    , (162, -3509043650042068507)
    , (163, 4399413560393194472)
    , (164, 7891567605415331488)
    , (165, 7217206322964748483)
    , (166, 3648563251023761823)
    , (167, -4819545604869286054)
    , (168, 7418097041988462101)
    , (169, 2205223007099476281)
    , (170, 4431448755045835766)
    , (171, -8221261003469584022)
    , (172, 3629369023695156164)
    , (173, 4902209843048033546)
    , (174, 1760320637903379559)
    , (175, 4843864232840863117)
    , (176, -9122742452311577837)
    , (177, 5752367954762371291)
    , (178, 8216276400338889835)
    , (179, -9149437603224725922)
    , (180, 8027193014050998386)
    , (181, -7232817568294597074)
    , (182, -8400855654022150534)
    , (183, -7753432818145671434)
    , (184, 7333886702148110089)
    , (185, -5123417127353192695)
    , (186, -2000219798306060876)
    , (187, -2179879647328148179)
    , (188, -7378519198517621176)
    , (189, -1817052629928570715)
    , (190, 7656994093073248867)
    , (191, 4184006200709920815)
    , (192, -8833087106700830503)
    , (193, 2783710666475235800)
    , (194, 4676158737070948442)
    , (195, 8645249063483478681)
    , (196, 4573052583285284334)
    , (197, -1149732075902129193)
    , (198, 8606783501353497577)
    , (199, 7804432860196640346)
    , (200, 34771365687048356)
    , (201, -3380909101958810624)
    , (202, -5745883166893592235)
    , (203, 1532020205534713173)
    , (204, -6844947957861016212)
    , (205, 3607402167957723140)
    , (206, 4949690570551399066)
    , (207, -5455771779390409054)
    , (208, -6021470795463623489)
    , (209, 5290653839573661676)
    , (210, 5651892297314389896)
    , (211, 2708586804055927055)
    , (212, 5768305528034109566)
    , (213, 3457216143046150959)
    , (214, 7981721404010695856)
    , (215, 7912840787294363394)
    , (216, -1814890715504135435)
    , (217, -7597486139356031573)
    , (218, 3271755057696027061)
    , (219, -48952671930317873)
    , (220, 7136889680411244229)
    , (221, -2348824101857902886)
    , (222, -7884182295594668439)
    , (223, -5313800426665443259)
    , (224, -2795597868923652930)
    , (225, -222443479260354896)
    , (226, 6173797836231597985)
    , (227, -1579541016762449672)
    , (228, -2835575251813505267)
    , (229, 8351849005333751248)
    , (230, 4309092338111678718)
    , (231, -8699890107441382158)
    , (232, -9167821762655916702)
    , (233, -8532581629361351877)
    , (234, -8667456450899615397)
    , (235, -2582635876336779902)
    , (236, 8132680801335606904)
    , (237, 1648314983852032847)
    , (238, 3295140437328013668)
    , (239, -1421580106819740075)
    , (240, -2907608628560255300)
    , (241, -6322816911947222458)
    , (242, -7589197463270828349)
    , (243, -8926046831893037557)
    , (244, 4896643601133708252)
    , (245, -6674175097673710357)
    , (246, 2459004753600259986)
    , (247, -1178556379777127983)
    , (248, 7297574458821998573)
    , (249, -1388497070535576337)
    , (250, -4961878236786218444)
    , (251, -1199587422524448313)
    , (252, 4924997501616113681)
    , (253, -5035836678414061217)
    , (254, -1051793459388456288)
    , (255, -3554085305936409967)
    , (256, -7453646461085874584)
    , (257, 148560080565500013)
    , (258, 8457915415190656280)
    , (259, -7322362186173411777)
    , (260, -5908642995440363322)
    , (261, -5138216243622281838)
    , (262, 6319033461847858341)
    , (263, 3593951235365171013)
    , (264, 143356472789382857)
    , (265, 6381314803980520445)
    , (266, 5856910227484163309)
    , (267, -8704073533802011265)
    , (268, 353159872114481143)
    , (269, 8162280881307154361)
    , (270, -3359821239417787509)
    , (271, -7306029847303484140)
    , (272, 8735479290235454287)
    , (273, -1788519416661437099)
    , (274, -9016336493651617180)
    , (275, 760753068184821537)
    , (276, -1916785139645466421)
    , (277, -8564992073910011681)
    , (278, 4993659043551079340)
    , (279, -6258752848793578203)
    , (280, -6776046873082250507)
    , (281, -3469768417555190919)
    , (282, -2097896384490711861)
    , (283, -3085035631392948881)
    , (284, -4276628062149501646)
    , (285, -6345802438551626139)
    , (286, -352657576296494949)
    , (287, -5367758872290675154)
    , (288, -7898054294117344444)
    , (289, 4631370819108650002)
    , (290, 2159450528269779126)
    , (291, 6642421276593547798)
    , (292, 8053870323586048348)
    , (293, 6075170510453292102)
    , (294, 8337276195577210898)
    , (295, 6455002339587381115)
    , (296, -8889252898421582205)
    , (297, 1146504690477137868)
    , (298, 7735678055269282276)
    , (299, -9189696311792692702)
    , (300, 5702423901673553364)
    , (301, 4382447778501093087)
    , (302, -8041965431155666886)
    , (303, -4218249522564426008)
    , (304, 1494308086499263248)
    , (305, -704312088466389203)
    , (306, -4508763087036506522)
    , (307, -3765887612654673358)
    , (308, 7224308346503032052)
    , (309, -8299144030141373871)
    , (310, -7498047320529816312)
    , (311, 5430417050421188481)
    , (312, 653108760363077789)
    , (313, 1481643386532304650)
    , (314, -6116402852535162926)
    , (315, -6682854836700890752)
    , (316, 7417735697007964914)
    , (317, 1170480021557407645)
    , (318, -7350605792084523469)
    , (319, 2198694763053100017)
    , (320, 3979502640286180910)
    , (321, 3343187474840866724)
    , (322, -1546357679947490085)
    , (323, -460357136342898027)
    , (324, -8537481803050761008)
    , (325, -6392009347055350831)
    , (326, -4134029776193805258)
    , (327, -7701329978779729830)
    , (328, -4467123380217693345)
    , (329, 7956417605155097225)
    , (330, 626092887558565570)
    , (331, -1399165066242258576)
    , (332, -2346728649540272187)
    , (333, -3794747196255883458)
    , (334, 1284393001702478979)
    , (335, -1109717615337192003)
    , (336, 6670934605474859969)
    , (337, 5492476560257438374)
    , (338, -2172727745806116257)
    , (339, -3503982950878447841)
    , (340, -8275510990026519139)
    , (341, 7483096351954336934)
    , (342, -417994487148536875)
    , (343, -6053640463989144756)
    , (344, 2803895119506110722)
    , (345, 6981753650744775717)
    , (346, -1232358860069853291)
    , (347, -3316129155461324530)
    , (348, 8555504562256780628)
    , (349, 8610374418296010923)
    , (350, -2936056190552398143)
    , (351, 1336814358339434861)
    , (352, -5923140253523267161)
    , (353, -8471936120640223398)
    , (354, -2670866271151539239)
    , (355, -5309137851362651946)
    , (356, 2126457965687913887)
    , (357, -7824517609306418417)
    , (358, 865014175574932877)
    , (359, 3725372848068418495)
    , (360, -8431647567621793917)
    , (361, 6417357755637334123)
    , (362, -2715927481393579880)
    , (363, 7155039284842173149)
    , (364, -7115541452306407536)
    , (365, -5581314419778713698)
    , (366, -3393331380360697586)
    , (367, 5446436408919014426)
    , (368, 3985861998486496575)
    , (369, 77594241618230917)
    , (370, -4620887403543981539)
    , (371, -2513041294921057498)
    , (372, 3922663970370265670)
    , (373, -877147219805500824)
    , (374, -4079377109242484377)
    , (375, 8256272212422156942)
    , (376, -4015341100316079770)
    , (377, -1017076004635252009)
    , (378, 1895548345102274405)
    , (379, -4821224235702827518)
    , (380, -5257985264100816952)
    , (381, -1926785902578348105)
    , (382, 2102183213453993934)
    , (383, 7624832075310434221)
    , (384, 8723854383992676638)
    , (385, -6926737996039764766)
    , (386, -8555346660238750481)
    , (387, 9179817071291920861)
    , (388, 6530820681914043643)
    , (389, -8353218560229554899)
    , (390, -5598896204367478370)
    , (391, 1745605160017108041)
    , (392, -6958100571364576759)
    , (393, -3879097676010398661)
    , (394, -6415139152818381909)
    , (395, -7789896163542403571)
    , (396, 3582429238432815031)
    , (397, -550677666916020274)
    , (398, 1578344630431149543)
    , (399, 5973396333226616937)
    , (400, 1900922774911955291)
    , (401, 4776156712888848058)
    , (402, -5748712080890598107)
    , (403, -1641593259211853039)
    , (404, 2898797030933559125)
    , (405, 6268422449293896614)
    , (406, -4742748359038490513)
    , (407, -6468518598328758006)
    , (408, 2692967517926221049)
    , (409, -4636351670283607197)
    , (410, 7671006473962887723)
    , (411, -1448864088792986762)
    , (412, 3996574555006368553)
    , (413, -63497967857031350)
    , (414, -1475253571986583357)
    , (415, -7637945546813556610)
    , (416, -6383952735387645708)
    , (417, -6776976525433967626)
    , (418, -4753064637205831523)
    , (419, 6316094563410302322)
    , (420, 3576646479134483276)
    , (421, -3502168252185751185)
    , (422, -6480303480524561092)
    , (423, 9208827653281630649)
    , (424, -7819248830217677919)
    , (425, 4259882174589719232)
    , (426, -1172615417518446790)
    , (427, -6532502571305628690)
    , (428, -3484557770359308431)
    , (429, -385860434691600509)
    , (430, -4414884186703597385)
    , (431, 7777528726467843479)
    , (432, -6731491201416570921)
    , (433, -5174541827094708328)
    , (434, 5675156752410765550)
    , (435, 4887778144173734851)
    , (436, 2860099293258271630)
    , (437, 6628891389343315827)
    , (438, 8255426863770769746)
    , (439, 1880199686716305908)
    , (440, -4000610630425792563)
    , (441, 2457552234838485589)
    , (442, -2610781766714115674)
    , (443, -3978671096720046170)
    , (444, -8286114799894979120)
    , (445, -733168019072760354)
    , (446, -6405164694637508965)
    , (447, 8739245032723521176)
    , (448, -8515514245660612759)
    , (449, 1720439637764957437)
    , (450, 5626477441294230074)
    , (451, 8101655599065209379)
    , (452, -8801089361382701747)
    , (453, 3913668433098078094)
    , (454, 8637164212353755299)
    , (455, 3370494437931763402)
    , (456, 6679648783053761914)
    , (457, 2815506513011638184)
    , (458, 5756833486373400215)
    , (459, 5478856590864976949)
    , (460, 4409591934901705145)
    , (461, 5347900074094718653)
    , (462, -4209524377949642193)
    , (463, -1376282222835513596)
    , (464, -3834614555154370874)
    , (465, 5862017948378252781)
    , (466, -8026422936705128538)
    , (467, 8663268244703457999)
    , (468, -4953715744890707932)
    , (469, -6161209798424447484)
    , (470, 7046039990152139141)
    , (471, -1358792941608179753)
    , (472, 8859893595018598812)
    , (473, 6534024416283704538)
    , (474, 7334435632203245164)
    , (475, 3085829974902445605)
    , (476, -2641840321718465804)
    , (477, 9030988462106960037)
    , (478, -3675285447787021184)
    , (479, -4404597129489689057)
    , (480, 7899471520794271999)
--     , (481, )
--     , (482, )
--     , (483, )
--     , (484, )
    , (485, 6389170491400638902)
    , (486, -3054095351834442799)
    , (487, -3311384180630362639)
--     , (488, )
--     , (489, )
--     , (490, )
    , (491, 8082981703737343856)
--     , (492, )
    , (493, -7265130903214364942)
--     , (494, )
--     , (495, )
    , (496, -4397335944557079944)
    , (497, -9054367248403159864)
    , (498, -2961230934128641009)
    , (499, 1976671715668705243)
    , (500, -2499668268720122729)
    , (501, -2492202688268043181)
--     , (502, )
    , (503, -6223612357008562325)
    , (504, -4842548135056411137)
--     , (505, )
    , (506, 4514171430025065209)
--     , (507, )
--     , (508, )
    , (509, 2383477720919832889)
    , (510, -7400990883170088546)
    , (511, -8874686069700489078)
    , (512, 5558544176673605037)
--     , (513, )
--     , (514, )
    , (515, -4097206707449760265)
    , (516, -9061052959329889828)
    , (517, -482049307449308495)
    , (518, 5002837824879528263)
    , (519, -2262098890898848978)
    , (520, 2705968100899977574)
    , (521, 9180549926139622439)
--     , (522, )
    ]
